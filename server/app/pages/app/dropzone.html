<div
  class="
    py-1
    after:block
    after:h-2
    after:rounded-sm
    [&[data-dragenter]]:after:bg-gradient-to-r
    after:from-sky-700 after:via-sky-400 after:to-sky-700
    last:h-full
  "
  ondragover="
    // Set dragover to trigger dropzone when hovering over child elements
    event.preventDefault();
    if (!this.hasAttribute('data-dragenter')) { // Prevents flickering
      this.setAttribute('data-dragenter', true);
    }
  "
  ondragenter="
    event.preventDefault();
    event.stopPropagation();
    this.setAttribute('data-dragenter', true);
  "
  ondragleave="
    event.stopPropagation();
    this.removeAttribute('data-dragenter');
  "
  ondrop="
    this.removeAttribute('data-dragenter');

    const taskId = event.dataTransfer.getData('text/plain');
    const taskElement = document.querySelector(`[name$='[_id]'][value='${taskId}']`).closest('[draggable]');

    if (![taskElement.previousElementSibling, taskElement.nextElementSibling].includes(this)) {
      const taskDropzone = taskElement.nextElementSibling;
      taskDropzone.parentElement.removeChild(taskDropzone);
      taskElement.parentElement.removeChild(taskElement);

      this.after(this.cloneNode(false));
      this.after(taskElement);

      // Update hidden input names
      // taskElement.querySelectorAll(`input[type='hidden']`).forEach((input) => {
      //   input.name = input.name.replace(
      //     /^lanes\[\d+\]\[tasks\]\[\d+\]/,
      //     `lanes[<%= laneIndex %>][tasks][<%= taskIndex %>]`
      //   );
      // });

      htmx.trigger(this.closest('form'), 'move-task');
    }
  "
>
  <% if (!task) { %>
    <div class="pt-2 font-bold">
      <%= lane.name %> <span class="inline-block px-2 rounded-full bg-slate-200"><%= lane.tasks.length %></span>
    </div>
  <% } %>
</div>
